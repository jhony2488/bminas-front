<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Dashboard | Saques Pendentes</title>
    <link rel="shortcut icon" href="/admin/assets/images/logo.png">
    
    <!-- import style:js -->
    <script src="/admin/static/js/styles.js"></script>
    <style>
      .notification {
    width: 7px;
    height: 7px;
    background-color: orange;
    border-radius: 50%;
    display: flex;
    justify-content: center;
    align-items: center;
    color: white;
    font-weight: bold;
  }

      .swal2-content {
        width: 100% !important;
      }

      .swal2-popup {
        min-width: 60% !important;
      }
    </style>
  </head>

  <div class="container-scroller">
    <!-- partial:partials/_navbar.html -->
    <div id="navbar-content"></div>

    <!-- partial -->
    <div class="container-fluid page-body-wrapper">

    <!-- partial:partials/_sidebar.html -->
    <div id="sidebar-content"></div>

    <!-- partial -->
    <div class="main-panel">
      <div class="content-wrapper">
				<div class="col-lg-12 grid-margin stretch-card">
        <div class="card">
          <div class="card-body">
          	<div class="d-flex align-items-center justify-content-between">
            	<h4 class="card-title"><i class="fa fa-table"></i> <strong>Configurações</strong></h4>
            </div>
            <hr>
            <br>
            <div class="row mt-2">
              <div class="col-md-6 mb-4">
                <div class="card" style="box-shadow: 0 2px 5px 0 rgb(0 0 0 / 16%), 0 2px 10px 0 rgb(0 0 0 / 12%);">
                  <div class="card-body">
                    <h3 class="card-title" style="text-transform: none;"><i class="fa fa-table"></i> <strong>Estornar</strong> Depósito/Bônus</h3>
                    <form id="estornar_deposito" method="post" enctype="multipart/form-data">
                      <fieldset>
                        <div class="col-md-12">
                          <div class="form-group">
                            <label class="form-label">ID do deposito/bônus:</label>
                            <input type="text" id="estornar_transaction_id" name="estornar_transaction_id" class="form-control" placeholder="Digite o ID do depósito/bônus">
                          </div>
                        </div>
                        <div class="col-md-12">
                          <div style="text-align:center" class="col-md-12 margin-bottom-30">
                            <button type="submit" name="estorno_dep" value="estorno_dep" class="btn btn-wide btn-success">Estornar Deposito</button>
                          </div>
                        </div>
                      </fieldset>
                    </form>
                  </div>
                </div>
              </div>

            	<div id="alt_estornodep" class="col-md-6 mb-4" style="display: none;">
                <div class="card" style="box-shadow: 0 2px 5px 0 rgb(0 0 0 / 16%), 0 2px 10px 0 rgb(0 0 0 / 12%);">
                  <div class="card-body">
                    <h3 class="card-title" style="text-transform: none;"><i class="fa fa-table"></i> <strong>Alterar</strong> status Depósito/Pendente</h3>
                     
                     <form id="deposit_status" method="post" enctype="multipart/form-data">
                       <fieldset>
                         <div class="col-md-12">
                           <div class="form-group">
                             <label class="form-label">ID do deposito:</label>
                             <input type="text" id="deposit_transaction_id" name="deposit_transaction_id" class="form-control" placeholder="Digite o ID da transação">
                          </div>
                        </div>
                        <div class="col-md-12">
                          <div style="text-align:center" class="col-md-12 margin-bottom-30">
                            <button type="submit" name="estorno_dep" value="estorno_dep" class="btn btn-wide btn-success">Alterar Status</button>
                          </div>
                        </div>
                      </fieldset>
                    </form>
                  </div>
                </div>
              </div>
            <!-- </div>

            <div class="row mt-2"> -->
            	<div class="col-md-6 mb-4">
            		<div class="card " style="box-shadow: 0 2px 5px 0 rgb(0 0 0 / 16%), 0 2px 10px 0 rgb(0 0 0 / 12%);">
            			<div class="card-body">
            				<h3 class="card-title" style="text-transform: none;"><i class="fa fa-table"></i> <strong>Resetar</strong> senha usuário</h3>

            				<form id="reset_senha" method="post" enctype="multipart/form-data">
            					<fieldset>
            						<div class="col-md-12">
            							<div class="form-group">
            								<label class="form-label">ID do usuário:</label>
            								<input type="text" id="reset_user_id" name="reset_user_id" class="form-control" placeholder="Digite o nome do usuário">
            							</div>
            						</div>
            						<!--div class="col-sm-12">
					                <div class="form-group">
					                  <label for=""> Senha:</label>
					                  <span id="msg" class="text-danger" style="font-size: 14px;float:right;"></span>
					                  <input class="form-control" id="reset_password" name="reset_password" value="123!@#$%" placeholder="Digite a nova senha do usuário" type="text" required>


					                </div>
					              </div>
					              <div class="col-sm-12">
					                <div class="form-group">
					                  <label for="">Confirme a senha:</label>
					                  <input class="form-control" id="confirm_password" name="confirm_password" placeholder="Confirme a nova senha do usuário" value="123!@#$%" type="text" required>
					                </div>
					              </div-->
            						<div class="col-md-12">
            							<div style="text-align:center" class="col-md-12 margin-bottom-30">
            								<button type="submit" name="resetar" value="resetar" class="btn btn-wide btn-success">Resetar Senha</button>
            							</div>
            						</div>
            					</fieldset>
            				</form>

            			</div>
            		</div>
            	</div>

            	<div id="game_prize" class="col-md-6 mb-4" style="display: none;">
            		<div class="card" style="box-shadow: 0 2px 5px 0 rgb(0 0 0 / 16%), 0 2px 10px 0 rgb(0 0 0 / 12%);">
            			<div class="card-body">
            				<h3 class="card-title" ><i class="fa fa-table"></i> <strong>Premiar</strong> Jogo</h3>

            				<form id="premiar_jogo" method="post" enctype="multipart/form-data">
            					<fieldset>
            						<div class="col-md-12">
            							<div class="form-group">
            								<label class="form-label">ID Jogo:</label>
            								<input type="text" id="jogo_premiado" name="jogo_premiado" class="form-control" value="">
            							</div>
            						</div>
            						<div class="col-md-12">
            							<div class="form-group">
            								<label class="form-label">Valor Prêmio:</label>
            								<input type="text" id="valor_premio" name="valor_premio" class="form-control" value="">
            							</div>
            						</div>

            						<div class="col-md-12">
            							<div style="text-align:center" class="col-md-12 margin-bottom-30">
            								<button type="submit" name="salva_jogo_premiado" value="salva_jogo_premiado" class="btn btn-wide btn-success">Premiar Jogo</button>
            							</div>
            						</div>
            					</fieldset>
            				</form>
            			</div>

            		</div>
            	</div>
            <!-- </div>

            <div class="row mt-3"> -->
            	<div id="alt_gamebalance" class="col-md-6 mb-4" style="display: none;">
            		<div class="card" style="box-shadow: 0 2px 5px 0 rgb(0 0 0 / 16%), 0 2px 10px 0 rgb(0 0 0 / 12%);">
            			<div class="card-body">
            				<h3 class="card-title" style="text-transform: none;"><i class="fa fa-table"></i> <strong>Alterar</strong> saldo jogo</h3>

            				<form id="saldo_jogo" method="post" enctype="multipart/form-data">
            					<fieldset>
            						<div class="col-md-12">
            							<div class="form-group">
            								<label class="form-label">ID do usuário:</label>
            								<input type="text" id="base_user_id" name="base_user_id" class="form-control" placeholder="Digite o ID do usuário">
            							</div>
            						</div>
            						<div class="col-md-12">
            							<div class="form-group">
            								<label class="form-label">Saldo:</label>
            								<input type="text" id="base_user_balance" name="base_user_balance" class="form-control money" placeholder="Digite o saldo desejado">
            							</div>
            						</div>

            						<div class="col-md-12">
            							<div style="text-align:center" class="col-md-12 margin-bottom-30">
            								<button type="submit" name="salva_debit" value="salva_debit" class="btn btn-wide btn-success">Alterar Saldo</button>
            							</div>
            						</div>
            					</fieldset>
            				</form>
            			</div>
            		</div>
            	</div>

            	<div id="alt_balanceprize" class="col-md-6 mb-4" style="display: none;">
            		<div class="card" style="box-shadow: 0 2px 5px 0 rgb(0 0 0 / 16%), 0 2px 10px 0 rgb(0 0 0 / 12%);">
            			<div class="card-body">
            				<h3 class="card-title" style="text-transform: none;"><i class="fa fa-table"></i> <strong>Alterar</strong> saldo prêmio</h3>

            				<form id="saldo_premio" method="post" enctype="multipart/form-data">
            					<fieldset>
            						<div class="col-md-12">
            							<div class="form-group">
            								<label class="form-label">ID do usuário:</label>
            								<input type="text" id="base_prize_user_id" name="base_prize_user_id" class="form-control" placeholder="Digite o ID do usuário">
            							</div>
            						</div>
            						<div class="col-md-12">
            							<div class="form-group">
            								<label class="form-label">Saldo:</label>
            								<input type="text" id="base_user_prize" name="base_user_prize" class="form-control money" placeholder="Digite o saldo desejado">
            							</div>
            						</div>

            						<div class="col-md-12">
            							<div style="text-align:center" class="col-md-12 margin-bottom-30">
            								<button type="submit" name="salva_debit" value="salva_debit" class="btn btn-wide btn-success">Alterar Saldo</button>
            							</div>
            						</div>
            					</fieldset>
            				</form>
            			</div>
            		</div>

            	</div>
            <!-- </div>
            
            <div class="row mt-3"> -->
            	<div id="add_prizebalance" class="col-md-6 mb-4" style="display: none;">
            		<div class="card" style="box-shadow: 0 2px 5px 0 rgb(0 0 0 / 16%), 0 2px 10px 0 rgb(0 0 0 / 12%);">
            			<div class="card-body">
            				<h3 class="card-title" style="text-transform: none;"><i class="fa fa-table"></i> <strong>Adicionar</strong> saldo de prêmio</h3>

            				<form id="prizebalance" method="post" enctype="multipart/form-data">
            					<fieldset>
            						<div class="col-md-12">
            							<div class="form-group">
            								<label class="form-label">ID do usuário:</label>
            								<input type="text" id="prize_user_id" name="prize_user_id" class="form-control" placeholder="Digite o ID do usuário">
            							</div>
            						</div>
            						<div class="col-md-12">
            							<div class="form-group">
            								<label class="form-label">Saldo prêmio:</label>
            								<input type="text" id="prize_amount" name="prize_amount" class="form-control money" placeholder="Digite o valor desejado">
            							</div>
            						</div>

            						<div class="col-md-12">
            							<div style="text-align:center" class="col-md-12">
            								<button type="submit" name="salva_debit" value="salva_debit" class="btn btn-wide btn-success">Adicionar saldo</button>
            							</div>
            						</div>
            					</fieldset>
            				</form>
            			</div>

            		</div>
            	</div>

            	<div id="add_gamebalance" class="col-md-6 mb-4" style="display: none;">
            		<div class="card" style="box-shadow: 0 2px 5px 0 rgb(0 0 0 / 16%), 0 2px 10px 0 rgb(0 0 0 / 12%);">
            			<div class="card-body">
            				<h3 class="card-title" style="text-transform: none;"><i class="fa fa-table"></i> <strong>Adicionar</strong> saldo de jogo</h3>

            				<form id="basebalance" method="post" enctype="multipart/form-data">
            					<fieldset>
            						<div class="col-md-12">
            							<div class="form-group">
            								<label class="form-label">ID do usuário:</label>
            								<input type="text" id="base_user_id" name="base_user_id" class="form-control" placeholder="Digite o ID do usuário" >
            							</div>
            						</div>
            						<div class="col-md-12">
            							<div class="form-group">
            								<label class="form-label">Saldo Jogo:</label>
            								<input type="text" id="base_amount" name="base_amount" class="form-control money" placeholder="Digite o valor desejado" >
            							</div>
            						</div>

            						<div class="col-md-12">
            							<div style="text-align:center" class="col-md-12">
            								<button type="submit" name="salva_debit" value="salva_debit" class="btn btn-wide btn-success">Adicionar Saldo</button>
            							</div>
            						</div>
            					</fieldset>
            				</form>

            			</div>
            		</div>
            	</div>
            </div>

          </div>
        </div>
      </div>

      </div>
      <!-- content-wrapper ends -->
      <div id="footer-content"></div>

  <!-- plugins:js -->
  <script src="../../admin/assets/vendors/js/vendor.bundle.base.js"></script>
  <script src="../../admin/assets/vendors/jquery-mask/dist/jquery.mask.min.js"></script>
  <script src="../../admin/assets/vendors/sweetalert2/dist/sweetalert2.all.min.js"></script>
  <script src="../../admin/assets/vendors/datatable/datatables.min.js"></script>
  <!-- import partials:js -->
  <script src="/admin/static/js/partials.js"></script>
  <script defer="defer" src="/admin/static/js/app.js"></script>
  <script defer="defer" src="/admin/assets/js/utils.js"></script>
  
  <script>
    const altEstornoCard = document.getElementById('alt_estornodep');
    const gamePrizeCard = document.getElementById('game_prize');
    const gameBalanceCard = document.getElementById('alt_gamebalance');
    const addGameBalanceCard = document.getElementById('add_gamebalance');
    const altPrizeBalanceCard = document.getElementById('alt_balanceprize');
    const addPrizeBalanceCard = document.getElementById('add_prizebalance');

    function checkLevel() {
      const dataString = sessionStorage.getItem('data');
      const data = JSON.parse(dataString);

      let levelParts = data.nToken.split('/');

      if (levelParts[1] === '3') {
        return true;
      } else {
        return false;
      }
    }

    console.log(checkLevel())

    if (checkLevel() === true) {
      altEstornoCard.style.display = 'block';
      gamePrizeCard.style.display = 'block';
      gameBalanceCard.style.display = 'block';
      addGameBalanceCard.style.display = 'block';
      altPrizeBalanceCard.style.display = 'block';
      addPrizeBalanceCard.style.display = 'block';
    }

    document.addEventListener('DOMContentLoaded', function() {

			function validarCampos(form, campos) {
			  let erros = [];

			  campos.forEach((campo) => {
			    const validate = form.querySelector(`[name="${campo}"]`);
			    if (!validate.value.trim()) {
			      erros.push(validate);
			      validate.classList.add("is-invalid");
			    } else {
			      validate.classList.remove("is-invalid");
			    }
			  });

			  return erros;
			}

			// function validarSenhas(){
			// 	var password = document.getElementById('reset_password').value;
			//   var confirmPassword = document.getElementById('confirm_password').value;
			//   var messageElement = document.getElementById('msg');

			//   if (password === confirmPassword) {
			//   	messageElement.textContent = ' ';
			//     console.log('senhas iguais')
			//     return true;
			//   } else { 
			//   	messageElement.textContent = '* As senhas digitadas não coincidem.';
			//   	console.log('senhas diferentes')			    
			//   	return false;
			//   }
			// }

			function alertMsg(){
				return Swal.fire({
          	toast: true,
          	type: 'warning',
          	width:"100%",
          	showConfirmButton: false,
          	position: 'top-end',
          	timer: 17200,
          	title: "Há campo(s) vazio(s)",
        	})
			}

			// Formulario 'Estornar Depósito/Bônus'
			const form_reverse_deposit = document.querySelector('#estornar_deposito');
			form_reverse_deposit.addEventListener('submit', function(event){
				event.preventDefault();

				const formData = new FormData(form_reverse_deposit);
				let obj = {
					transaction_id: formData.get('estornar_transaction_id'),
				};

				const camposObrigatorios = ["estornar_transaction_id"];
				const erros = validarCampos(form_reverse_deposit, camposObrigatorios);

				if (erros.length === 0) {

					salvarDados('/api_admin/transactions/deposit/reverse', obj);
				} else {
					alertMsg();
				}			
			});

			// Formulario 'Adicionar Saldo/Jogo'
			const form_add_base_balance = document.querySelector('#basebalance');
			form_add_base_balance.addEventListener('submit', function(event){
				event.preventDefault();

				const formData = new FormData(form_add_base_balance);
				let obj = {
					amount: formData.get('base_amount').replaceAll('.', '').replace(',', '.'),
					user_id: parseInt(formData.get('base_user_id')),
				};

				const camposObrigatorios = ["base_amount", "base_user_id"];
				const erros = validarCampos(form_add_base_balance, camposObrigatorios);

				if (erros.length === 0) {

					salvarDados('/api_admin/users/add-base-balance', obj);
				} else {
					alertMsg();
				}			
			});

			// Formulario 'Adicionar Saldo Do Prêmio'
			const form_add_prize_balance = document.querySelector('#prizebalance');
			form_add_prize_balance.addEventListener('submit', function(event){
				event.preventDefault();

				const formData = new FormData(form_add_prize_balance);console.log(formData)
				let obj = {
					amount: formData.get('prize_amount').replaceAll('.', '').replace(',', '.'),
					user_id: parseInt(formData.get('prize_user_id')),
				};

				const camposObrigatorios = ["prize_amount", "prize_user_id"];
				const erros = validarCampos(form_add_prize_balance, camposObrigatorios);

				if (erros.length === 0) {

					salvarDados('/api_admin/users/add-prize-balance', obj);
				} else {
					alertMsg();
				}			
			});

			// Formulario 'Alterar Status Depósito/Pendente'
			const form_deposit_status = document.querySelector('#deposit_status');
			form_deposit_status.addEventListener('submit', function(event){
				event.preventDefault();

				const formData = new FormData(form_deposit_status);
				let obj = {
					transaction_id: formData.get('deposit_transaction_id'),
				};

				const camposObrigatorios = ["deposit_transaction_id"];
				const erros = validarCampos(form_deposit_status, camposObrigatorios);

				if (erros.length === 0) {

					salvarDados('/api_admin/transactions/deposit/status', obj);
				} else {
					alertMsg();
				}			
			});

			// Formulario 'Reset senha'
			const form_reset_pass = document.querySelector('#reset_senha');
			form_reset_pass.addEventListener('submit', function(event){
				event.preventDefault();

				const formData = new FormData(form_reset_pass);
				let obj = {
					user_id: parseInt(formData.get('reset_user_id')),
					// password: parseInt(formData.get('reset_password')),
				};

				const camposObrigatorios = ["reset_user_id"];
				const erros = validarCampos(form_reset_pass, camposObrigatorios);
				// const senhas = validarSenhas();
				// console.log(senhas)

				if (erros.length === 0) {
					salvarDados('/api_admin/users/reset-user-pass', obj);
				} else {
					alertMsg();
				}			
			});

			// Formulario 'Premiar jogo'
			const form_prize_game = document.querySelector('#premiar_jogo');
			form_prize_game.addEventListener('submit', function(event){
				event.preventDefault();

				const formData = new FormData(form_prize_game);
				let obj = {
					game_id: parseInt(formData.get('jogo_premiado')),
					value_prize: parseInt(formData.get('valor_premio')),
				};

				const camposObrigatorios = ["jogo_premiado", "valor_premio"];
				const erros = validarCampos(form_prize_game, camposObrigatorios);

				if (erros.length === 0) {
					salvarDados('/api_admin/games/award_game', obj);
				} else {
					alertMsg();
				}			
			});

			// Formulario 'Alterar Saldo jogo'
			const form_base_balance = document.querySelector('#saldo_jogo');
			form_base_balance.addEventListener('submit', function(event){
				event.preventDefault();

				const formData = new FormData(form_base_balance);
				let obj = {
					user_id: parseInt(formData.get('base_user_id')),
					base_balance: formData.get('base_user_balance').replaceAll('.', '').replace(',', '.'),
				};

				const camposObrigatorios = ["base_user_id","base_user_balance"];
				const erros = validarCampos(form_base_balance, camposObrigatorios);

				if (erros.length === 0) {

					salvarDados('/api_admin/users/', obj);
				} else {
					alertMsg();
				}			
			});

			// Formulario 'Alterar Saldo premio'
			const form_base_prize = document.querySelector('#saldo_premio');
			form_base_prize.addEventListener('submit', function(event){
				event.preventDefault();

				const formData = new FormData(form_base_prize);
				let obj = {
					user_id: parseInt(formData.get('base_prize_user_id')),
					prize_balance: formData.get('base_user_prize').replaceAll('.', '').replace(',', '.'),
				};

				const camposObrigatorios = ["base_user_prize","base_prize_user_id"];
				const erros = validarCampos(form_base_prize, camposObrigatorios);

				if (erros.length === 0) {

					salvarDados('/api_admin/users/', obj);
				} else {
					alertMsg();
				}			
			});

      $('.money').mask('000.000.000.000.000,00', {
        reverse: true
      });

      // save data
      async function salvarDados(address, pData) {
        try {
        	console.log(address)
          const response = await fetch(address, {
            method: 'PUT',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify(pData)
          });

          const data = await response.json();

					if (data.status == 200) {
            Swal.fire({
              type: "success",
              showConfirmButton: false,
              timer: 1500,
              title: data.message
            })
            setTimeout(
              function() {
                location.reload();
              }, 1600);
           } else {
            Swal.fire({
              type: "error",
              showConfirmButton: false,
              timer: 2000,
              title: data.message
            })
          }
        } catch (error) {
          console.log(error);
        } finally {
        }
      }
    });
  </script>
</body>
</html>
