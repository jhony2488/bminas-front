<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Dashboard | Imagem do prêmiado</title>
    <link rel="shortcut icon" href="/admin/assets/images/logo.png">
    
    <!-- import style:js -->
    <script src="/admin/static/js/styles.js"></script>

    <style>
      @import url('https://fonts.googleapis.com/css2?family=Ubuntu:wght@300;400;500;700&display=swap');

      .container-contour {
        /* border: 6px solid #31E300; */
        /* border-radius: 40px; */
        /* box-shadow: 0px 0px 9px 1px #00ff03; */
        /* -webkit-box-shadow:0px 0px 39px 1px #00ff03; */
        padding: 30px 30px 25px 30px;
        margin: 20px 20px;
        display: flex;
        align-items: center;
        justify-content: center;
        flex-direction: column;
        z-index: 2;
        position: relative;
      }

      .main-content .page-content {
        overflow: unset;
      }

      .imageResults {
        font-family: 'Ubuntu', sans-serif;
        height: 1920px;
        width: 1080px;
        display: flex;
        text-align: center;
        flex-direction: column;
        color: #2AC2BA;
        background-color: #333333;
        position: relative;
        /* justify-content: space-between; */
        padding: 45px 40px 30px 40px;
      }

      .contentResults {
        color: #2AC2BA;
        display: flex;
        justify-content: center;
        align-items: center;
        /*margin-top: 0px;*/
      }

      img[alt="logo-first-place"] {
        position: absolute;
        left: -35px;
        top: -5px;
      }

      .contentResults ul>li>span {
        margin: 0 20px;
        color: #c1c1c1;
      }

      .contentResults ul>li>span:first-of-type {
        margin: 0 15px;
        color: #fff;
      }

      .whatsapp .contentResults ul {
        margin-right: 50px;
      }

      .whatsapp .contentResults ul>li {
        list-style: none;
        font-size: 32px;
        font-weight: 600;
        margin: 20px 0;
        display: flex;
        align-items: center;
        position: relative;
      }

      .whatsapp .footer-image {
        display: flex;
        padding: 0 90px;
        justify-content: space-between;
        align-items: center;
        z-index: 2;
      }

      .whatsapp .footer-image>div:first-child img {
        margin: 10px 0;
      }

      .whatsapp .footer-image ul li p {
        margin: 0;
        margin-left: 10px;
      }

      .whatsapp .footer-image ul li {
        display: flex;
        align-items: center;
        font-size: 30px;
      }

      .download {
        padding: 30px;
        border: 0;
        box-shadow: none;
        background: #1a3f92;
        border-radius: 10px;
        font-weight: 600;
        font-size: 22px;
        margin: 0;
        color: #fff;
        margin-bottom: 5px;
      }

      .download:disabled {
        background: gray;
        color: #000;
      }

      @media only screen and (min-width: 900px) {
        .download {
          width: 1080px;
        }
      }

      .instagram .footer-image {
        display: flex;
        padding: 0 50px;
        align-items: center;
        z-index: 2;
        flex-direction: column;
      }

      .instagram .footer-image ul {
        display: flex;
        justify-content: space-between;
        margin-top: 60px;
        width: 100%;
        list-style: none;
      }

      .instagram .footer-image ul li {
        display: flex;
        align-items: center;
        font-size: 35px;
        /* margin: 0 10px; */
      }

      .instagram .footer-image ul li p {
        margin: 0;
        margin-left: 10px;
      }

      .instagram .contentResults ul {
        /*margin-right: 60px;*/
      }

      .instagram .contentResults ul>li>span:nth-of-type(1) {
        font-weight: 600;
      }

      .instagram .contentResults ul>li {
        list-style: none;
        font-size: 4.02rem;
        /* font-weight: 600; */
        /*padding: 30px 0;*/
        display: flex;
        align-items: center;
        position: relative;
        /*margin: 30px 0;*/
      }

      .instagram .contentResults img[alt="logo-first-place"] {
        top: 28%;
        left: -65px;
      }

      .instagram .contentResults {
        color: #2AC2BA;
        display: flex;
        justify-content: center;
        align-items: center;
        margin-top: 10px;
        /* margin-bottom: 100px; */
        /* border: 2px solid #2AC2BA; */
        border-radius: 20px;
        flex: 1;
        width: 100%;
        padding: 0;
      }
    </style>
  </head>

  <div class="container-scroller">
    <!-- partial:partials/_navbar.html -->
    <div id="navbar-content"></div>

    <!-- partial -->
    <div class="container-fluid page-body-wrapper">

    <!-- partial:partials/_sidebar.html -->
    <div id="sidebar-content"></div>

    <!-- partial -->
    <div class="main-panel">
      <div class="content-wrapper">

        <div class="col-lg-12 grid-margin stretch-card">
          <div class="card">
            <div class="card-body">
              <div class="d-flex align-items-center justify-content-between">
                <h4 class="card-title" style="text-transform: none;"><strong>Imagem do prêmiado: "ID <span id="resultado_id"></span> - <span id="resultado_nome"></span>"</strong></h4>

                <button class="btn btn-sm btn-success d-flex align-items-center" id="salvar-imagem"  data-toggle="tooltip" title="Baixar imagem .png"><i class="icon-cloud-download"></i>&nbsp; Baixar Imagem</button>
              </div>
              <hr>
              <br>

              <div class="row">
                <div class="col-md-12">

                  <div class="instagram">
                    <div class="table-responsive">
                      <div class="imageResults" id="imageResults1">
                        <img src="/admin/assets/images/back-story.png" alt="" style="height: 100%;width: 100%;position: absolute; left: 0; top: 0;">
                  
                        <div style="display: flex;width: 100%;justify-content: center;z-index: 2;">
                          <img src="/admin/assets/images/logo.svg" alt="" width="35%" crossorigin="anonymous">
                        </div>
                  
                        <div class="container-contour" style="margin-top: 60px;">
                          <h2 style="font-size: 4.4rem;font-weight: bold;margin-bottom: 10px;color: #b1b1b1">Resultado</h2>
                          <p id="date-title" style="font-size: 3.1rem;color: #fff; margin: 15px 0;white-space: nowrap;"></p>
                          <p id="lotery-desc" style="font-size: 45px;color: #fff; margin-top: 55px;white-space: nowrap;"></p>
                          <h2 style="font-size: 70px;font-weight: bold;margin: 20px 0;color: #2AC2BA;white-space: nowrap;"><span id="lotery-sigla"></span> - <span id="lotery-hour"></span></h2>
                            
                          <div class="contentResults">
                            <ul style="line-height: 1.5 !important;white-space: nowrap;">
                              <li>
                                <img src="/admin/assets/images/first-icon.svg" alt="logo-first-place" height="70" style="display: inline;" crossorigin="anonymous">
                                  <span>1º</span><span id="i_premio1"></span> <span id="i_gpremio1"></span>
                              </li>
                              <li><span>2º</span><span id="i_premio2"></span> <span id="i_gpremio2"></span> </li>
                              <li><span>3º</span><span id="i_premio3"></span> <span id="i_gpremio3"></span> </li>
                              <li><span>4º</span><span id="i_premio4"></span> <span id="i_gpremio4"></span> </li>
                              <li><span>5º</span><span id="i_premio5"></span> <span id="i_gpremio5"></span> </li>
                              <li><span>6º</span><span id="i_premio6"></span> <span id="i_gpremio6"></span> </li>
                              <li><span>7º</span><span id="i_premio7"></span> <span id="i_gpremio7"></span> </li>
                            </ul>
                          </div>
                        </div>
                        <p style="font-size: 40px;color: #fff;z-index:2; text-align: center;font-weight: 500;margin-top:95px;">@bichomania.oficial</p>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <!-- content-wrapper ends -->
      <div id="footer-content"></div>

  <!-- plugins:js -->
  <script src="/admin/assets/vendors/js/vendor.bundle.base.js"></script>
  <script src="/admin/assets/js/html2canvas.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/dom-to-image/2.6.0/dom-to-image.min.js"></script>

  <!-- import partials:js -->
  <script src="/admin/static/js/partials.js"></script>
  <script defer="defer" src="/admin/static/js/app.js"></script>
  
  <script>
    document.addEventListener('DOMContentLoaded', function() {

      const url = window.location.href;
      const urlParts = url.split('/');
      const idResult = urlParts[urlParts.length - 2];
      const dataResult = urlParts[urlParts.length - 1];
      const salvarImg = document.getElementById('salvar-imagem');

      $('#resultado_id').text(idResult);
      $('[data-toggle="tooltip"]').tooltip();

      // get list
      async function carregarDados() {
        try {
          const response = await fetch('/api_admin/lotteries/draw-results?date='+dataResult, {
            method: 'GET',
            headers: {
              'Content-Type': 'application/json'
            }
          });

          if(response.status === 200) {

            const data = await response.json();
            const resultData = data.find(obj => obj.result_id == idResult);

            console.log(resultData);

            const dataTitle = $('#date-title');
            const formattedDate = formatDate(resultData.date_of_calculation);
            dataTitle.text(formattedDate);

            $('#resultado_nome').text(resultData.name);
            $('#i_premio1').text(resultData.first_place);
            $('#i_premio2').text(resultData.second_place);
            $('#i_premio3').text(resultData.third_place);
            $('#i_premio4').text(resultData.fourth_place);
            $('#i_premio5').text(resultData.fifith_place);
            $('#i_premio6').text(resultData.sixth_place);
            $('#i_premio7').text(resultData.seventh_place);

            $('#i_gpremio1').text(resultData.animal_1);
            $('#i_gpremio2').text(resultData.animal_2);
            $('#i_gpremio3').text(resultData.animal_3);
            $('#i_gpremio4').text(resultData.animal_4);
            $('#i_gpremio5').text(resultData.animal_5);
            $('#i_gpremio6').text(resultData.animal_6);
            $('#i_gpremio7').text(resultData.animal_7);

            $('#lotery-desc').text(resultData.group_desc);
            $('#lotery-sigla').text(resultData.abbreviated);

            let horaMinuto = resultData.hour_limit.split(':', 2);
            let horaFormatada = `${horaMinuto[0].padStart(2, '0')}:${horaMinuto[1].padStart(2, '0')}`;
            $('#lotery-hour').text(horaFormatada);

          } else if (response.status === 401) {
            location.reload();
          } else {
            throw new Error('Erro na requisição: ' + response.status);
          }
        } catch (error) {
          console.log(error);
        }
      }
      carregarDados();

      document.getElementById('salvar-imagem').addEventListener('click', () => {

        const imageResultsDiv = document.getElementById('imageResults1');
        domtoimage.toPng(imageResultsDiv, { width: imageResultsDiv.offsetWidth, height: imageResultsDiv.offsetHeight })
          .then(dataUrl => {
            const link = document.createElement('a');

            link.download = 'RESULT-' + idResult + '-' + dataResult + '.png';
            link.href = dataUrl;
            link.click();
          })
          .catch(error => {
            console.error('Erro ao criar a imagem:', error);
          });
      });

      function formatDate(dateString) {
        const options = { day: 'numeric', month: 'long', year: 'numeric' };
        const date = new Date(dateString + 'T00:00:00');
        return date.toLocaleDateString('pt-BR', options);
      }
    })
  </script>
</body>

</html>
