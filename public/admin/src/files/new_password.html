<!DOCTYPE html>

<html lang="pt-br">

<head>
	<title>Nova Senha - Bicho Premiado</title>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<!-- Google Tag Manager -->
	<script>(function (w, d, s, l, i) {
			w[l] = w[l] || []; w[l].push({
				'gtm.start':
					new Date().getTime(), event: 'gtm.js'
			}); var f = d.getElementsByTagName(s)[0],
				j = d.createElement(s), dl = l != 'dataLayer' ? '&l=' + l : ''; j.async = true; j.src =
					'https://www.googletagmanager.com/gtm.js?id=' + i + dl; f.parentNode.insertBefore(j, f);
		})(window, document, 'script', 'dataLayer', 'GTM-WHPGFP9');</script>
	<!-- End Google Tag Manager -->
	<!--===============================================================================================-->
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/css/bootstrap.min.css" rel="stylesheet"
		integrity="sha384-F3w7mX95PdgyTmZZMECAngseQB83DfGTowi0iMjiWaeVhAn4FJkqJByhZMI3AhiU" crossorigin="anonymous">
	<!--===============================================================================================-->
	<link rel="stylesheet" href="/website/assets/font-awesome/css/all.css">
	<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="fonts/iconic/css/material-design-iconic-font.min.css">
	<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="/website/assets/password/vendor/animate/animate.css">
	<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="/website/assets/password/vendor/css-hamburgers/hamburgers.min.css">
	<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="/website/assets/password/vendor/animsition/css/animsition.min.css">
	<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="/website/assets/password/vendor/select2/select2.min.css">
	<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="/website/assets/password/vendor/daterangepicker/daterangepicker.css">
	<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="/website/assets/password/css/util.css">
	<link rel="stylesheet" type="text/css" href="/website/assets/password/css/main.css">
	<!--===============================================================================================-->
</head>

<body>
	<!-- Google Tag Manager (noscript) -->
	<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-WHPGFP9" height="0" width="0"
			style="display:none;visibility:hidden"></iframe></noscript>
	<!-- End Google Tag Manager (noscript) -->
	<div class="limiter">
		<div class="container-login100">
			<div class="wrap-login100">

				<form class="login100-form validate-form" autocapitalize="off" autocomplete="new-password">
					<input type="text" style="display:none">
					<input type="password" style="display:none">
					<span class="login100-form-title p-b-26" style="color: #004B90">
						Alterar nova senha
					</span>
					<span class="login100-form-title p-b-48">
						<img src="/website/assets/images/logo-header.png" alt="logo-header" width="80px auto">
					</span>


					<div class="wrap-input100 validate-input" data-validate="Digite o código">
						<input class="input100 required" type="tel" name="otp_code" id="otp_code" maxlength="4" minlength="4"
							autocapitalize="off" autocomplete="new-password" ma>
						<span class="focus-input100" data-placeholder="Código enviado via SMS"></span>
					</div>

					<div class="wrap-input100 validate-input" data-validate="Digite sua Senha">
						<span class="btn-show-pass">
							<i class="zmdi zmdi-eye"></i>
						</span>
						<input class="input100 required" type="password" name="senha" id="senha" min-length="5"
							autocomplete="new-password">
						<span class="focus-input100" data-placeholder="Nova Senha"></span>
					</div>

					<div class="wrap-input100 validate-input" data-validate="Repita sua Senha">
						<span class="btn-show-pass">
							<i class="zmdi zmdi-eye"></i>
						</span>
						<input class="input100 required" type="password" name="rSenha" id="rSenha" min-length="5"
							autocomplete="new-password">
						<span class="focus-input100" data-placeholder="Repita a Nova Senha"></span>
					</div>
					<div class="container-login100-form-btn">
						<div class="wrap-login100-form-btn">
							<div class="login100-form-bgbtn"></div>
							<button class="login100-form-btn" id="alterar" name="alterar" type="button" onclick="alterarSenha()">
								Alterar Senha
							</button>
						</div>
					</div>

				</form>
			</div>
		</div>
	</div>
	<div id="dropDownSelect1"></div>

	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"
		integrity="sha512-894YE6QWD5I59HgZOGReFYm4dnWc1Qt5NtvYSaNcOP+u1T9qYdvdihz0PPSiiqn/+/3e7Jo4EaG7TubfWGUrMQ=="
		crossorigin="anonymous"></script>
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/js/bootstrap.bundle.min.js"
		integrity="sha384-/bQdsTh/da6pkI1MST/rWKFNjaCP5gBSY4sEBT38Q/9RBh9AH40zEOg7Hlq2THRZ"
		crossorigin="anonymous"></script>
	<script src="/website/assets/password/main.js"></script>
	<script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.mask/1.14.16/jquery.mask.min.js"
		integrity="sha512-pHVGpX7F/27yZ0ISY+VVjyULApbDlD0/X0rgGbTqCE7WFW5MezNTWG/dnhtbBuICzsd0WQPgpE4REBLv+UqChw=="
		crossorigin="anonymous" referrerpolicy="no-referrer"></script>


	<script>
		const queryString = window.location.search;
		const urlParams = new URLSearchParams(queryString);

		const code = urlParams.get('code')
		console.log(code);
		const username = urlParams.get('username')
		console.log(username);
		const token = urlParams.get('token')
		console.log(token);

		function setIpuntCodeWithParams() {
			if (code) {

				$("#otp_code").val(code).focus()
				$("#senha").focus()
			}
		}
		setIpuntCodeWithParams();

		function alterarSenha() {

			let erro = false
			$(".required").each((index, value) => {
				if ($(value).val().trim() == "" || $(value).parent().hasClass("alert-validate")) {
					erro = true;
					$(value).parent().addClass("alert-validate")
				}
			})

			let code = $("#otp_code").val()
			let senha = $("#senha").val()

			if (code == "") {
				erro = true;
				Swal.fire({
					customClass: 'swalfix',
					title: 'Preencha com o código que chegou no seu celular.',
					text: 'Tente novamente.',
					type: 'error',
				})
				return false;
			}


			if ($("#senha").val().length < 6) {
				erro = true;
				Swal.fire({
					customClass: 'swalfix',
					title: 'Digite uma senha com no minimo 6 digitos',
					text: 'Tente novamente.',
					type: 'error',
				})
				return false;
			}

			if (!erro) {
				if ($("#senha").val() == $("#rSenha").val()) {
					$.ajax({
						type: "GET",
						url: "atualizar_senha.php",
						data: {
							"chave": chave,
							"email": email,
							"senha": senha
						},
						success: (response) => {
							// console.log(response)
							if (response.trim() == 'erro') {
								// console.log(result.value)
								Swal.fire({
									customClass: 'swalfix',
									title: 'Código e/ou Token inválido',
									text: 'Tente novamente.',
									type: 'error',
								})
							} else {
								data = response.split(',');
								Swal.fire({
									customClass: 'swalfix',
									// title: 'Verifique seu email e clique no link para redefinir a senha.',
									title: 'Senha atualizada com Sucesso',
									// text: '',
									type: 'success',
								})
								window.location.href = "/";
							}
							// $("#result").html(response)
						}
					});
				} else {
					Swal.fire({
						customClass: 'swalfix',
						title: 'Senhas não coincidem.',
						text: 'Tente novamente.',
						type: 'error',
					})
				}
			}


		}
	</script>

</body>

</html>